{% extends 'base.html' %}

{% block title %}GOSMEBEL{% endblock %}

{% block content %}
<!-- Hero Section -->
<header id="home" class="hero">
    <div class="parallax-background">
        <div class="pattern-overlay"></div>
    </div>
    <div class="hero-content">
        <h1 class="slide-in-text">Современный дизайн <br>для современного жилья</h1>
        <p class="slide-in-text">Откройте для себя нашу кураторскую коллекцию современных предметов мебели, созданных для улучшения вашего пространства.</p>
        <div class="hero-cta-buttons slide-in-text">
            <a href="#contact" class="btn btn-primary">Получить консультацию <i class="fas fa-headset"></i></a>
            <a href="{% url 'main_page' %}#collections" class="btn btn-secondary">Посмотреть коллекции <i class="fas fa-arrow-right"></i></a>
        </div>
    </div>
    <div class="hero-image">
        <div class="floating-element" data-speed="1.2"></div>
        <div class="floating-element" data-speed="0.8"></div>
        <div class="floating-element" data-speed="1.5"></div>
    </div>
</header>

<!-- Collections Section -->
<section id="collections" class="collections scroll-reveal">
    <div class="container">
        <div class="section-header fade-up">
            <h2>Наши Коллекции</h2>
            <p>Откройте для себя наши уникальные коллекции</p>
        </div>
        
        <div class="categories-container">
            <div class="collection-grid stagger-fade">
                {% for category in featured_categories %}
                <div class="collection-item" data-category-id="{{ category.id }}">
                    <div class="collection-card">
                        <!-- Front side -->
                        <div class="card-front">
                            <div class="image-container">
                                <img src="{{ category.image.url }}" alt="{{ category.name }}" loading="lazy">
                                <div class="image-overlay">
                                    <div class="overlay-content">
                                        <h3>{{ category.name }}</h3>
                                        <p>{{ category.description }}</p>
                                    </div>
                                </div>
                                <div class="split-overlay">
                                    <div class="split-top"></div>
                                    <div class="split-bottom"></div>
                                </div>
                            </div>
                        </div>
                        <!-- Back side -->
                        <div class="card-back">
                            <div class="back-content">
                                <h3>{{ category.name }}</h3>
                                <p>{{ category.description }}</p>
                                <ul class="category-details">
                                    <li><i class="fas fa-check"></i> Индивидуальный дизайн</li>
                                    <li><i class="fas fa-check"></i> Премиум материалы</li>
                                    <li><i class="fas fa-check"></i> Гарантия качества</li>
                                </ul>
                                <button class="btn btn-secondary">Подробнее</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="products-container" style="display: none;">
            <!-- Products will be loaded here -->
        </div>
    </div>
</section>

<!-- Why Choose Us Section -->
<section id="why-choose-us" class="why-choose-us scroll-reveal">
    <div class="container">
        <div class="section-header fade-up">
            <h2>Почему выбирают нас</h2>
            <p>Мы создаем не просто мебель, а пространство для жизни</p>
        </div>
        
        <div class="features-grid stagger-fade">
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="fas fa-pencil-ruler"></i>
                </div>
                <h3>Индивидуальный дизайн</h3>
                <p>Создаем уникальные решения, учитывая ваши потребности и стиль жизни</p>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="fas fa-certificate"></i>
                </div>
                <h3>10+ лет опыта</h3>
                <p>Многолетний опыт в создании качественной мебели и довольных клиентов</p>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="fas fa-tools"></i>
                </div>
                <h3>Современное производство</h3>
                <p>Используем передовое оборудование и инновационные технологии</p>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <h3>Точные сроки</h3>
                <p>Гарантируем своевременное выполнение заказа и доставку</p>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="fas fa-hand-holding-heart"></i>
                </div>
                <h3>Гарантия качества</h3>
                <p>Предоставляем длительную гарантию на всю нашу продукцию</p>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="fas fa-comments-dollar"></i>
                </div>
                <h3>Гибкая оплата</h3>
                <p>Предлагаем удобные условия оплаты и рассрочку</p>
            </div>
        </div>
    </div>
</section>

<!-- Statistics Section -->
<section id="statistics" class="statistics scroll-reveal">
    <div class="container">
        <div class="stats-grid">
            <div class="stat-item fade-up">
                <div class="stat-number">
                    <span class="counter" data-target="1500">0</span>
                    <span class="plus">+</span>
                </div>
                <h3>Довольных клиентов</h3>
            </div>
            
            <div class="stat-item fade-up" data-delay="200">
                <div class="stat-number">
                    <span class="counter" data-target="10">0</span>
                    <span>лет</span>
                </div>
                <h3>На рынке</h3>
            </div>
            
            <div class="stat-item fade-up" data-delay="400">
                <div class="stat-number">
                    <span class="counter" data-target="2000">0</span>
                    <span class="plus">+</span>
                </div>
                <h3>Выполненных проектов</h3>
            </div>
            
            <div class="stat-item fade-up" data-delay="600">
                <div class="stat-number">
                    <span class="counter" data-target="98">0</span>
                    <span>%</span>
                </div>
                <h3>Положительных отзывов</h3>
            </div>
        </div>
    </div>
</section>

<!-- About Section -->
<section id="about" class="about">
    <div class="container">
        <div class="section-header">
            <h2>Наше обязательство</h2>
        </div>
        <div class="about-grid">
            <div class="about-item">
                <i class="fas fa-award"></i>
                <h3>Премиум качество</h3>
                <p>Изготовлено с исключительными материалами и вниманием к деталям</p>
            </div>
            <div class="about-item">
                <i class="fas fa-truck"></i>
                <h3>Доставка с белыми перчатками</h3>
                <p>Профессиональная доставка и сборка</p>
            </div>
            <div class="about-item">
                <i class="fas fa-infinity"></i>
                <h3>Гарантия на всю жизнь</h3>
                <p>Наше обязательство к качеству на долгие годы</p>
            </div>
        </div>
    </div>
</section>

<!-- Contact Section -->
<section id="contact" class="contact">
    <div class="container">
        <div class="section-header">
            <h2>Свяжитесь с нами</h2>
        </div>
        <div class="contact-grid">
            <form class="contact-form">
                <input type="text" class="form-control" placeholder="Имя" required>
                <input type="email" class="form-control" placeholder="Электронная почта" required>
                <textarea class="form-control" placeholder="Сообщение" rows="5" required></textarea>
                <button type="submit" class="btn">Отправить сообщение <i class="fas fa-paper-plane"></i></button>
            </form>
            <div class="contact-info">
                <div class="about-item location-card">
                    <h3 class="location-title">Работа</h3>
                    <p class="location-address">Ташкент, улица Буюк Ипак Йули, 233</p>
                    <p class="location-coordinates">Координаты: <span class="coordinate-values">41.334487, 69.352042</span> <i class="fas fa-copy"></i></p>

                </div>
                <div class="about-item">
                    <i class="fas fa-phone"></i>
                    <h3>Позвоните нам</h3>
                    <p>+998910172324</p>
                    <p>+998998460907</p>
                    <p>+998941612021</p>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const collectionGrid = document.querySelector('.collection-grid');
    const productsContainer = document.querySelector('.products-container');
    const categoriesContainer = document.querySelector('.categories-container');
    
    // Function to show categories
    window.showCategories = function() {
        if (categoriesContainer) {
            categoriesContainer.style.display = 'block';
        }
        if (productsContainer) {
            productsContainer.style.display = 'none';
        }
        // Reset the collection grid to its original state
        if (collectionGrid) {
            collectionGrid.style.display = 'grid';
        }
    };

    // Function to show products
    function showProducts() {
        if (categoriesContainer) {
            categoriesContainer.style.display = 'none';
        }
        if (productsContainer) {
            productsContainer.style.display = 'block';
        }
    }

    // Function to load products for a category
    async function loadCategoryProducts(categoryId, page = 1) {
        try {
            const response = await fetch(`{% url 'products:get-category-products' %}?category_id=${categoryId}&page=${page}`, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            if (data.html) {
                productsContainer.innerHTML = data.html;
                showProducts(); // Show products after loading
                // Attach pagination event listeners
                attachPaginationListeners(categoryId);
                // Initialize carousels for new products
                initializeCarousels();
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }
    
    // Function to attach pagination event listeners
    function attachPaginationListeners(categoryId) {
        const paginationLinks = document.querySelectorAll('.page-link');
        paginationLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = link.dataset.page;
                loadCategoryProducts(categoryId, page);
            });
        });
    }
    
    // Function to initialize all carousels
    function initializeCarousels() {
        const carousels = document.querySelectorAll('.carousel');
        carousels.forEach(carousel => {
            const items = carousel.querySelectorAll('.carousel-item');
            if (items.length > 1) {
                // Reset carousel state
                items.forEach((item, index) => {
                    item.classList.remove('active');
                    if (index === 0) item.classList.add('active');
                });

                const inner = carousel.querySelector('.carousel-inner');
                if (inner) inner.style.transform = 'translateX(0)';

                const indicators = carousel.querySelectorAll('.indicator');
                indicators.forEach((indicator, index) => {
                    indicator.classList.remove('active');
                    if (index === 0) indicator.classList.add('active');
                });
            }
        });
    }
    
    // Carousel functions
    window.moveCarousel = function(button, direction) {
        const carousel = button.closest('.carousel');
        const inner = carousel.querySelector('.carousel-inner');
        const items = carousel.querySelectorAll('.carousel-item');
        const indicators = carousel.querySelectorAll('.indicator');
        
        let activeIndex = [...items].findIndex(item => item.classList.contains('active'));
        let newIndex = activeIndex + direction;
        
        if (newIndex < 0) newIndex = items.length - 1;
        if (newIndex >= items.length) newIndex = 0;
        
        // Update active classes
        items[activeIndex].classList.remove('active');
        items[newIndex].classList.add('active');
        
        if (indicators.length) {
            indicators[activeIndex].classList.remove('active');
            indicators[newIndex].classList.add('active');
        }
        
        // Move the carousel
        inner.style.transform = `translateX(-${newIndex * 100}%)`;
    }
    
    window.goToSlide = function(carousel, index) {
        const items = carousel.querySelectorAll('.carousel-item');
        const indicators = carousel.querySelectorAll('.indicator');
        const inner = carousel.querySelector('.carousel-inner');
        
        // Find current active index
        const currentIndex = [...items].findIndex(item => item.classList.contains('active'));
        
        // Update active classes
        items[currentIndex].classList.remove('active');
        items[index].classList.add('active');
        
        if (indicators.length) {
            indicators[currentIndex].classList.remove('active');
            indicators[index].classList.add('active');
        }
        
        // Move the carousel
        inner.style.transform = `translateX(-${index * 100}%)`;
    }
    
    // Attach click events to collection items
    const collectionItems = document.querySelectorAll('.collection-item');
    collectionItems.forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const categoryId = item.dataset.categoryId;
            loadCategoryProducts(categoryId);
        });
    });

    // Initialize copy coordinates functionality
    const copyIcon = document.querySelector('.location-coordinates i.fa-copy');
    if (copyIcon) {
        copyIcon.addEventListener('click', function() {
            const coordinates = document.querySelector('.coordinate-values').textContent;
            navigator.clipboard.writeText(coordinates).then(() => {
                // Optional: Show a small tooltip or change icon temporarily
                const originalClass = copyIcon.className;
                copyIcon.className = 'fas fa-check';
                setTimeout(() => {
                    copyIcon.className = originalClass;
                }, 1500);
            });
        });
    }
});
</script>
{% endblock %}